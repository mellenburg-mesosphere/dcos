#!/bin/bash
source /opt/mesosphere/environment.export
export LIB_INSTALL_DIR="$PKG_PATH/lib/python3.5/site-packages"
mkdir -p "$LIB_INSTALL_DIR"

# Copy from the ro /pkg/extra to a rw folder.
cp -r /pkg/extra /build

pip3 install --no-deps --install-option="--prefix=$PKG_PATH" --root=/ /build

#  Make the UI assets available to the installer
mkdir -p "$LIB_INSTALL_DIR/dcos_installer/"
ln -s /opt/mesosphere/active/dcos-installer-ui/usr/ "$LIB_INSTALL_DIR/dcos_installer/templates"

cd /build
py.test
